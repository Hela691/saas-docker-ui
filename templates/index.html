<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Docker SAAS</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 30px;
    }

    h1, h2 {
      margin-bottom: 10px;
    }

    .card {
      background: #fff;
      padding: 15px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 15px;
    }

    button {
      padding: 8px 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn-create { background: #28a745; color: white; }
    .btn-start  { background: #007bff; color: white; }
    .btn-stop   { background: #ffc107; color: black; }
    .btn-delete { background: #dc3545; color: white; }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    th, td {
      border-bottom: 1px solid #eee;
      padding: 10px;
      text-align: left;
      vertical-align: top;
    }

    th {
      background: #f0f0f0;
    }

    .status-running { color: green; font-weight: bold; }
    .status-exited  { color: gray; font-weight: bold; }

    .ports {
      font-family: monospace;
      font-size: 0.9em;
    }

    form.inline {
      display: inline;
    }
  </style>
</head>

<body>

<h1>üê≥ Docker SAAS</h1>
<p>Cr√©ation et gestion de conteneurs Nginx via Flask + Docker SDK</p>

<!-- ================= CREATE FORM ================= -->
<div class="card">
  <h2>‚ûï Cr√©er un conteneur Nginx</h2>

  <form method="POST" action="/create">
    <label>Nom du site</label>
    <input type="text" name="site_name" placeholder="ex: mon-site" required>

    <label>Contenu HTML</label>
    <textarea name="html_content" rows="6"
      placeholder="<h1>Bienvenue üöÄ</h1><p>Mon site cr√©√© depuis le SAAS</p>"></textarea>

    <button class="btn-create" type="submit">Cr√©er le conteneur</button>
  </form>
</div>

<!-- ================= CONTAINER LIST ================= -->
<h2>üì¶ Conteneurs Docker</h2>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Nom</th>
      <th>Image</th>
      <th>Statut</th>
      <th>Ports</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    {% for c in containers %}
    <tr>
      <td>{{ c.id }}</td>
      <td>{{ c.name }}</td>
      <td>{{ c.image }}</td>

      <td class="status-{{ c.status }}">
        {{ c.status }}
      </td>

      <td class="ports">
        {% if c.ports %}
          <ul>
            {% for p in c.ports %}
              <li>{{ p }}</li>
            {% endfor %}
          </ul>
        {% else %}
          -
        {% endif %}
      </td>

      <td>
        {% if c.ports %}
        {% for p in c.ports %}
          {% set port = p.split(':')[1].split(' ')[0] %}
          <a href="http://{{ request.host.split(':')[0] }}:{{ port }}"
             target="_blank"
             style="margin-right:6px;">
            <button>Open</button>
          </a>
        {% endfor %}
      {% endif %}
        {% if c.status != "running" %}
          <form class="inline" method="POST" action="/container/{{ c.id }}/start">
            <button class="btn-start">Start</button>
          </form>
        {% else %}
          <form class="inline" method="POST" action="/container/{{ c.id }}/stop">
            <button class="btn-stop">Stop</button>
          </form>
        {% endif %}

        <form class="inline" method="POST"
              action="/container/{{ c.id }}/delete"
              onsubmit="return confirm('Supprimer {{ c.name }} ?');">
          <button class="btn-delete">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

</body>
</html>
